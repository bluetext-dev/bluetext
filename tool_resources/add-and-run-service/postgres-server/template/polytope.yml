tools:
  {{ project-name }}:
    info: |
      Runs a PostgreSQL database server in dev mode.
      Uses the persistent volume `postgres-data-{{ project-name }}`.
      Exposes the PostgreSQL port on `{{ project-name }}:5432` within the job, and at `localhost:5432` on the host.
    await: [load-config]
    run:
      - tool: polytope/postgres
        args:
          image: postgres:16.2
          env:
            - { name: POSTGRES_DB, value: "{pt.value {{ project-name }}-database}" }
            - { name: POSTGRES_USER, value: "{pt.value {{ project-name }}-username}" }
            - { name: POSTGRES_PASSWORD, value: "{pt.secret {{ project-name }}-password}" }
            - { name: POSTGRES_HOST_AUTH_METHOD, value: scram-sha-256 }
          restart: { policy: always }
          data-path: /var/lib/postgresql/data
          service-id: {{ project-name }}
          data-volume: { id: postgres-data-{{ project-name }}, type: volume, scope: project }