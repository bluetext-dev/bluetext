tools:
  temporal:
    info: "Runs Temporal with auto-initialization"
    await: [set-values-and-secrets]
    run:
      - tool: polytope/container
        args:
          await: false
          image: temporalio/auto-setup:1.26.3.0
          id: temporal
          restart:
            policy: always
          services:
            - id: temporal
              ports:
                - {label: grpc, protocol: tcp, port: 7233, expose-as: 7233}
          env:
            - {name: DB, value: pt.value temporal-db}
            - {name: DB_PORT, value: pt.value temporal-db-port}
            - {name: DYNAMIC_CONFIG_FILE, value: pt.value temporal-dynamic-config-file}
            - {name: LOG_LEVEL, value: pt.value temporal-log-level}
            - {name: POSTGRES_PWD, value: pt.secret temporal-postgres-pwd}
            - {name: POSTGRES_SEEDS, value: pt.value temporal-postgres-seeds}
            - {name: POSTGRES_USER, value: pt.value temporal-postgres-user}
            - {name: TEMPORAL_ADDRESS, value: pt.value temporal-address}
            - {name: TEMPORAL_CLI_ADDRESS, value: pt.value temporal-cli-address}
          mounts:
            - path: /etc/temporal/config
              source: {type: volume, scope: project, id: temporal-config}
          create: when-missing
