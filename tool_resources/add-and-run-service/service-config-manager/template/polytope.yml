tools:
  {{ project-name }}:
    info: |
      Service Config Manager - auto-discovers and manages registered database servers.
      Servers are mounted at /couchbase-servers/<name>/ and /postgres-servers/<name>/.
      The manager scans these directories at runtime to discover which servers to manage.
    await: [load-config]

    run:
      - tool: polytope/python
        args:
          await: false
          image: python:3.11.8-slim-bookworm
          id: {{ project-name }}
          restart: { policy: always }
          code: { type: repo, path: . }
          cmd: ./bin/run
          create: when-missing
          env:
            - { name: ENVIRONMENT, value: "pt.value {{ project-name }}-environment" }
          mounts:
            - { path: /root/.cache/, source: { type: volume, scope: project, id: dependency-cache } }
            # Dynamic server mounts are injected by the scaffolding step based on couchbase-servers and postgres-servers variables
